@page "/"
@inject NavigationManager Navigation
@inject IJSRuntime JsRuntime
@inherits HomeModel
@rendermode InteractiveServer
<PageTitle>Главная</PageTitle>
<link href="/DictionaryOfStyles.css" rel="stylesheet" />
<style>

</style>
<header>
	<img class="log" src="/Pictures/Headlines/MainWave.png" style="width: 100%;height: auto;" ondragstart="return false;">
	<div class="container">
		<div class="overlay-text">
			<h1>Acoustic fingerprint</h1>
			<p>
				сжатая цифровая сводка, цифровой отпечаток пальца, детерминированно сгенерированный
				на основе аудиосигнала, который можно использовать для идентификации аудиосэмпла
				или быстрого поиска похожих элементов в музыкальной базе данных.
			</p>
		</div>
	</div>
</header>

<label class="button-download">
	📁 Выбрать .wav файл
	<InputFile OnChange="ExeptionView"
			   accept=".wav"
			   style="display: none;" />
</label>

@code{
	protected override void OnInitialized()
	{
		ClearCache();
	}
	public async Task ExeptionView(InputFileChangeEventArgs e)
	{
		try
		{
			if (!e.File.Name.EndsWith(".wav", StringComparison.OrdinalIgnoreCase))
			{
				await JsRuntime.InvokeVoidAsync("alert", "Требуется файл формата .wav");
				return;
			}
			HandleFileSelected(e);
		}
		catch (Exception ex)
		{
			Console.WriteLine("Ошибка: " + ex.Message);
		}
	}
	public async Task ClearCache()
	{
		await JsRuntime.InvokeVoidAsync("eval",
			"caches.keys().then(function(names) { names.forEach(function(name) { caches.delete(name); }) }");

		await JsRuntime.InvokeVoidAsync("eval",
			"if ('serviceWorker' in navigator) { navigator.serviceWorker.getRegistrations().then(function(registrations) { registrations.forEach(function(registration) { registration.unregister(); }); } }");
	}
}